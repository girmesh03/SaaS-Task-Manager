# Implementation Plan: Backend Validation and Correction

## Overview

This implementation plan systematically validates and corrects all 76 files in the `backend/*` directory to ensure strict alignment with specifications in `.kiro/specs/saas-task-manager-mvp/*` and `docs/*`. Each task follows the SEARCH → ANALYZE → COMPARE → IDENTIFY → IMPLEMENT → VERIFY workflow with line-by-line cross-validation across ALL backend files.

**CRITICAL**: For EVERY line of code in each file, cross-validation MUST be performed by identifying and searching the item, logic, and everything related to the thing being validated across ALL occurrences in ALL backend files.

## Tasks

- [ ] 1. Git Pre-Operations and Setup

  - Execute `git status` to check current branch, uncommitted changes, staged/unstaged files
  - Execute `git branch -vv` to display branch tracking information
  - Execute `git fetch origin` to update remote tracking information
  - IF uncommitted changes exist THEN add, commit, push, checkout, merge, delete branch from local/remote and sync local with remote. Think twice before you act
  - IF local branch is behind remote THEN execute `git pull origin <branch>` to synchronize
  - IF merge conflicts detected THEN halt and prompt user to resolve manually
  - Create feature branch: `git checkout -b validate/backend-comprehensive`
  - Verify clean state before proceeding
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 23.1, 23.2, 23.3, 23.4, 23.5, 23.6, 23.7_

- [ ] 2. Validate and Correct backend/config/\*

  - **Pre-Analysis**: Read `.kiro/specs/backend-validation-correction/requirements.md`, `.kiro/specs/backend-validation-correction/design.md`, `.kiro/specs/saas-task-manager-mvp/requirements.md`, `.kiro/specs/saas-task-manager-mvp/design.md`, `docs/build-prompt.md`, `docs/softDelete-doc.md`, `docs/TIMEZONE-MANAGEMENT.md` completely
  - **SEARCH**: Discover all files in `backend/config/*` (allowedOrigins.js, authorizationMatrix.json, corsOptions.js, db.js)
  - **ANALYZE**: For EACH file, for EACH line:
    - Extract imports, exports, constants, functions, configurations
    - Identify CORS origins, authorization matrix structure, database connection patterns
    - Document MongoDB connection pooling (min: 2, max: 10), retry logic
    - For EACH code element (constant, function, config), search ALL occurrences across ALL backend files
    - Verify consistency in: naming, parameters, usage patterns, imports
  - **COMPARE**: Match against specifications:
    - Verify CORS origins match allowed list (development: localhost:3000, localhost:5173; production: CLIENT_URL + ALLOWED_ORIGINS)
    - Verify authorization matrix structure: {Resource: {Role: {operation: [scopes]}}}
    - Verify corsOptions: credentials: true, methods: GET/POST/PUT/PATCH/DELETE/OPTIONS, no wildcards in production
    - Verify db.js: connection pooling, retry logic, error handling
    - Verify ES module syntax (import/export, NOT require/module.exports)
  - **IDENTIFY**: Document issues:
    - Hardcoded origins instead of environment variables
    - Missing authorization matrix entries
    - Incorrect CORS configuration
    - Missing connection pooling configuration
    - CommonJS syntax instead of ES modules
    - Cross-validation inconsistencies across files
  - **IMPLEMENT**: Apply corrections:
    - Replace hardcoded values with environment variables
    - Add missing authorization matrix entries per design.md
    - Fix CORS configuration to match specifications
    - Add connection pooling configuration
    - Convert to ES module syntax
    - Apply corrections consistently across ALL related occurrences found during cross-validation
  - **VERIFY**: Without running tests:
    - Re-read all corrected files completely
    - Confirm all issues resolved
    - Confirm corrections match specifications exactly
    - Confirm no new issues introduced
    - Confirm imports correct and complete
    - Perform cross-validation to confirm consistency across all related files
    - Document verification results
  - **REPORT**: Append `docs/validate-correct.md` with SEARCH, ANALYZE, COMPARE, IDENTIFY, IMPLEMENT, VERIFY sections for backend/config/\*
  - _Requirements: 2.1, 3.1, 3.2, 3.3, 3.4, 3.5, 4.1-4.20, 5.1-5.10, 6.1-6.10, 7.1-7.11, 8.1-8.11, 9.1-9.11, 10.1-10.11, 11.1, 12.9, 12.10, 13.1-13.11_

- [ ] 3. Validate and Correct backend/controllers/\*

  - **Pre-Analysis**: Read `.kiro/specs/backend-validation-correction/requirements.md`, `.kiro/specs/backend-validation-correction/design.md`, `.kiro/specs/saas-task-manager-mvp/requirements.md`, `.kiro/specs/saas-task-manager-mvp/design.md`, `docs/build-prompt.md`, `docs/softDelete-doc.md`, `docs/TIMEZONE-MANAGEMENT.md` completely
  - **SEARCH**: Discover all files in `backend/controllers/*` (attachmentControllers.js, authControllers.js, departmentControllers.js, materialControllers.js, notificationControllers.js, organizationControllers.js, taskActivityControllers.js, taskCommentControllers.js, taskControllers.js, userControllers.js, vendorControllers.js)
  - **ANALYZE**: For EACH file, for EACH line:
    - Extract all imports, exports, controller functions, error handling patterns
    - Identify CustomError usage, transaction patterns, soft delete operations, timezone handling
    - Document request/response handling, validation integration, authorization checks
    - For EACH code element (function, error handler, transaction), search ALL occurrences across ALL backend files
    - Verify consistency in: error handling, transaction patterns, soft delete usage, timezone conversions
  - **COMPARE**: Match against specifications:
    - Verify CustomError ONLY uses static methods (validation, authentication, authorization, notFound, conflict, internal)
    - Verify ALL write operations use MongoDB transactions with session parameter
    - Verify transaction pattern: startSession → startTransaction → operations with {session} → commitTransaction → emit Socket.IO AFTER commit → catch abortTransaction → finally endSession
    - Verify soft delete operations pass {session} parameter
    - Verify dates stored in UTC: dayjs(date).utc().toDate()
    - Verify constants imported from utils/constants.js (NEVER hardcoded)
    - Verify multi-tenancy: organizationId filtering on ALL queries
    - Verify pagination using mongoose-paginate-v2
    - Verify response transformation using responseTransform utility
  - **IDENTIFY**: Document issues:
    - CustomError constructor usage instead of static methods
    - Write operations without transactions
    - Missing session parameter in database operations
    - Socket.IO events emitted before transaction commit
    - Missing session.endSession() in finally block
    - Hardcoded constants instead of imports
    - Missing organizationId filtering
    - Incorrect timezone handling
    - Cross-validation inconsistencies across controllers, validators, utils, middlewares, schema
  - **IMPLEMENT**: Apply corrections:
    - Replace CustomError constructor with static methods
    - Wrap ALL write operations in transactions
    - Add session parameter to ALL database operations
    - Move Socket.IO emissions after commitTransaction
    - Add session.endSession() in finally blocks
    - Replace hardcoded values with constants imports
    - Add organizationId filtering to ALL queries
    - Fix timezone handling to use UTC storage
    - Apply corrections consistently across ALL related occurrences
  - **VERIFY**: Without running tests:
    - Re-read all corrected files completely
    - Confirm all transaction patterns correct
    - Confirm all CustomError usage correct
    - Confirm all soft delete operations correct
    - Confirm all timezone handling correct
    - Confirm no hardcoded constants
    - Perform cross-validation across all controllers
    - Document verification results
  - **REPORT**: Append `docs/validate-correct.md` with complete analysis for backend/controllers/\*
  - _Requirements: 2.1, 3.1-3.5, 4.1-4.20, 5.1-5.10, 6.1-6.10, 7.1-7.11, 8.1-8.11, 9.1-9.11, 10.1-10.11, 11.1, 12.1-12.8, 13.1-13.11_

- [ ] 4. Validate and Correct backend/errorHandler/\*

  - **Pre-Analysis**: Read `.kiro/specs/backend-validation-correction/requirements.md`, `.kiro/specs/backend-validation-correction/design.md`, `.kiro/specs/saas-task-manager-mvp/requirements.md`, `.kiro/specs/saas-task-manager-mvp/design.md`, `docs/build-prompt.md`, `docs/softDelete-doc.md`, `docs/TIMEZONE-MANAGEMENT.md` completely
  - **SEARCH**: Discover all files in `backend/errorHandler/*` (CustomError.js, ErrorController.js)
  - **ANALYZE**: For EACH file, for EACH line:
    - Extract CustomError class definition, static methods, error properties
    - Extract ErrorController middleware, error response formatting, logging
    - Identify error status codes, error messages, error metadata handling
    - For EACH code element (static method, error handler), search ALL occurrences across ALL backend files
    - Verify consistency in: error creation patterns, error handling, error responses
  - **COMPARE**: Match against specifications:
    - Verify CustomError has ONLY static methods: validation(message, details), authentication(message), authorization(message, details), notFound(resource, identifier), conflict(message, details), internal(message, details)
    - Verify CustomError constructor is private/not exported
    - Verify ErrorController handles all error types: CustomError, ValidationError, CastError, MongoError, JWT errors
    - Verify error responses include: success: false, message, statusCode, details (if applicable)
    - Verify production mode hides stack traces
    - Verify winston logger integration for error logging
    - Verify NO constructor usage anywhere in codebase
  - **IDENTIFY**: Document issues:
    - CustomError constructor exposed or used directly
    - Missing static methods
    - Incorrect error status codes
    - Missing error type handling in ErrorController
    - Stack traces exposed in production
    - Missing logger integration
    - Cross-validation: constructor usage in other files
  - **IMPLEMENT**: Apply corrections:
    - Make CustomError constructor private
    - Add missing static methods
    - Fix error status codes per specifications
    - Add missing error type handlers
    - Hide stack traces in production
    - Integrate winston logger
    - Remove ALL constructor usage across codebase
    - Apply corrections consistently across ALL related occurrences
  - **VERIFY**: Without running tests:
    - Re-read all corrected files completely
    - Confirm CustomError constructor not accessible
    - Confirm all static methods present and correct
    - Confirm ErrorController handles all error types
    - Confirm no constructor usage in entire codebase
    - Perform cross-validation across all files using CustomError
    - Document verification results
  - **REPORT**: Append `docs/validate-correct.md` with complete analysis for backend/errorHandler/\*
  - _Requirements: 2.1, 3.1-3.5, 4.1-4.20, 5.1-5.10, 6.1-6.10, 7.1-7.11, 8.1-8.11, 9.1-9.11, 10.1-10.11, 11.1, 12.1, 13.1-13.11_

- [ ] 5. Validate and Correct backend/middlewares/\* (excluding validators/)

  - **Pre-Analysis**: Read `.kiro/specs/backend-validation-correction/requirements.md`, `.kiro/specs/backend-validation-correction/design.md`, `.kiro/specs/saas-task-manager-mvp/requirements.md`, `.kiro/specs/saas-task-manager-mvp/design.md`, `docs/build-prompt.md`, `docs/softDelete-doc.md`, `docs/TIMEZONE-MANAGEMENT.md` completely
  - **SEARCH**: Discover all files in `backend/middlewares/*` excluding validators subdirectory (authMiddleware.js, authorization.js, rateLimiter.js)
  - **ANALYZE**: For EACH file, for EACH line:
    - Extract JWT verification logic, token extraction from cookies, user attachment to req
    - Extract RBAC enforcement logic, permission checking, scope validation
    - Extract rate limiting configuration, window duration, max requests
    - For EACH code element (middleware function, permission check), search ALL occurrences across ALL backend files
    - Verify consistency in: JWT handling, authorization patterns, rate limiting
  - **COMPARE**: Match against specifications:
    - Verify authMiddleware extracts JWT from HTTP-only cookies (NOT headers)
    - Verify JWT verification uses ACCESS_TOKEN_SECRET
    - Verify user data attached to req.user (isDeleted, isHod, isPlatformUser) with populated organization: {name, isDeleted, isPlatformOrg}, department: {name, isDeleted, hod} and other fields
    - Verify authorization.js uses authorizationMatrix from utils/authorizationMatrix.js
    - Verify permission checks: checkPermission(resource, operation, userRole, requiredScopes)
    - Verify rateLimiter ONLY applied in production (NODE_ENV === 'production')
    - Verify rate limit: windowMs: 15 _ 60 _ 1000, max: 100
    - Verify CustomError usage for auth/authz failures
  - **IDENTIFY**: Document issues:
    - JWT extracted from headers instead of cookies
    - Missing (isDeleted, isHod, isPlatformUser) with populated organization: {name, isDeleted, isPlatformOrg}, department: {name, isDeleted, hod} and other fields in req.user
    - Hardcoded authorization logic instead of matrix
    - Rate limiter applied in development
    - Incorrect rate limit configuration
    - CustomError constructor usage
    - Cross-validation: inconsistent auth patterns across routes
  - **IMPLEMENT**: Apply corrections:
    - Fix JWT extraction to use cookies
    - Add (isDeleted, isHod, isPlatformUser) with populated organization: {name, isDeleted, isPlatformOrg}, department: {name, isDeleted, hod} and other fields to req.user
    - Replace hardcoded logic with authorizationMatrix
    - Apply rate limiter only in production
    - Fix rate limit configuration
    - Replace CustomError constructor with static methods
    - Apply corrections consistently across ALL related occurrences of the `backend/*`
  - **VERIFY**: Without running tests:
    - Re-read all corrected files completely
    - Confirm JWT from cookies only
    - Confirm authorization uses matrix
    - Confirm rate limiter production-only
    - Perform cross-validation across all `backend/*`
    - Document verification results
  - **REPORT**: Append `docs/validate-correct.md` with complete analysis for backend/middlewares/\*
  - _Requirements: 2.1, 3.1-3.5, 4.1-4.20, 5.1-5.10, 6.1-6.10, 7.1-7.11, 8.1-8.11, 9.1-9.11, 10.1-10.11, 11.1, 12.2, 13.1-13.11_

- [ ] 6. Validate and Correct backend/middlewares/validators/\*

  - **Pre-Analysis**: Read `.kiro/specs/backend-validation-correction/requirements.md`, `.kiro/specs/backend-validation-correction/design.md`, `.kiro/specs/saas-task-manager-mvp/requirements.md`, `.kiro/specs/saas-task-manager-mvp/design.md`, `docs/build-prompt.md`, `docs/softDelete-doc.md`, `docs/TIMEZONE-MANAGEMENT.md` completely
  - **SEARCH**: Discover all files in `backend/middlewares/validators/*` (validation.js, authValidators.js, userValidators.js, organizationValidators.js, departmentValidators.js, taskValidators.js, taskActivityValidators.js, taskCommentValidators.js, materialValidators.js, vendorValidators.js)
  - **ANALYZE**: For EACH file, for EACH line:
    - Extract express-validator chains, validation rules, custom validators
    - Extract validation middleware that checks validationResult
    - Identify field validations: required, type, format, length, custom logic
    - For EACH validation rule, search ALL occurrences across ALL backend files
    - Verify consistency in: validation patterns, error messages, custom validators
  - **COMPARE**: Match against specifications:
    - Verify express-validator v7.2.1 syntax (check, body, param, query)
    - Verify validation middleware throws CustomError.validation() on errors
    - Verify required fields per design.md schemas
    - Verify email format validation using isEmail()
    - Verify password strength: min 8 chars, uppercase, lowercase, number, special char
    - Verify enum validations match constants from utils/constants.js
    - Verify ObjectId validation using isMongoId()
    - Verify date validation and format
    - Verify custom validators for business logic (unique email, valid references)
    - Verify sanitization: trim(), escape() where appropriate
  - **IDENTIFY**: Document issues:
    - Missing required field validations
    - Incorrect validation rules
    - Hardcoded enum values instead of constants
    - Missing custom validators
    - Incorrect error handling (not using CustomError.validation)
    - Missing sanitization
    - Cross-validation: inconsistent validation patterns across `backend/*`
  - **IMPLEMENT**: Apply corrections:
    - Add missing required field validations
    - Fix validation rules per specifications
    - Replace hardcoded enums with constants imports
    - Add missing custom validators
    - Fix error handling to use CustomError.validation
    - Add sanitization where needed
    - Apply corrections consistently across ALL `backend/*`
  - **VERIFY**: Without running tests:
    - Re-read all corrected files completely
    - Confirm all required fields validated
    - Confirm all enums use constants
    - Confirm all custom validators present
    - Perform cross-validation across all `backend/*`
    - Document verification results
  - **REPORT**: Append `docs/validate-correct.md` with complete analysis for backend/middlewares/validators/\*
  - _Requirements: 2.1, 3.1-3.5, 4.1-4.20, 5.1-5.10, 6.1-6.10, 7.1-7.11, 8.1-8.11, 9.1-9.11, 10.1-10.11, 11.1, 12.3, 13.1-13.11_

- [ ] 7. Validate and Correct backend/models/\* (excluding plugins/)

  - **Pre-Analysis**: Read `.kiro/specs/backend-validation-correction/requirements.md`, `.kiro/specs/backend-validation-correction/design.md`, `.kiro/specs/saas-task-manager-mvp/requirements.md`, `.kiro/specs/saas-task-manager-mvp/design.md`, `docs/build-prompt.md`, `docs/softDelete-doc.md`, `docs/TIMEZONE-MANAGEMENT.md` completely
  - **SEARCH**: Discover all files in `backend/models/*` excluding plugins subdirectory (Organization.js, Department.js, User.js, BaseTask.js, ProjectTask.js, RoutineTask.js, AssignedTask.js, TaskActivity.js, TaskComment.js, Material.js, Vendor.js, Attachment.js, Notification.js, index.js)
  - **ANALYZE**: For EACH file, for EACH line:
    - Extract schema definitions, field types, validations, indexes
    - Extract discriminator patterns (BaseTask → ProjectTask/RoutineTask/AssignedTask)
    - Extract soft delete plugin application
    - Extract pre/post hooks, virtual fields, instance methods, static methods
    - For EACH schema field, search ALL occurrences across ALL backend files
    - Verify consistency in: field names, types, references, indexes
  - **COMPARE**: Match against specifications:
    - Verify ALL models apply softDeletePlugin: schema.plugin(softDeletePlugin)
    - Verify discriminator pattern: BaseTask (discriminatorKey: 'taskType'), ProjectTask/RoutineTask/AssignedTask extend BaseTask
    - Verify field types match design.md schemas exactly
    - Verify required fields, default values, enums match specifications
    - Verify references use correct model names and ref paths
    - Verify indexes: organization on ALL models, compound indexes per design.md
    - Verify timestamps: {timestamps: true} on ALL schemas
    - Verify date fields stored as Date type (UTC conversion in controllers)
    - Verify constants imported from utils/constants.js for enums
    - Verify mongoose-paginate-v2 plugin on paginated models
    - Verify pre-save hooks for password hashing (User model)
    - Verify cascade soft delete hooks where specified
  - **IDENTIFY**: Document issues:
    - Missing softDeletePlugin application
    - Incorrect discriminator configuration
    - Field type mismatches
    - Missing required fields or incorrect defaults
    - Hardcoded enum values
    - Missing indexes
    - Missing timestamps
    - Incorrect reference configurations
    - Missing pagination plugin
    - Missing or incorrect hooks
    - Cross-validation: inconsistent field names across `backend/*`
  - **IMPLEMENT**: Apply corrections:
    - Add softDeletePlugin to ALL models
    - Fix discriminator configuration
    - Correct field types per specifications
    - Add missing required fields and defaults
    - Replace hardcoded enums with constants
    - Add missing indexes
    - Add timestamps to ALL schemas
    - Fix reference configurations
    - Add pagination plugin where needed
    - Add missing hooks
    - Apply corrections consistently across ALL `backend/*`
  - **VERIFY**: Without running tests:
    - Re-read all corrected files completely
    - Confirm ALL models have softDeletePlugin
    - Confirm discriminator pattern correct
    - Confirm all fields match specifications
    - Confirm all indexes present
    - Perform cross-validation across all `backend/*`
    - Document verification results
  - **REPORT**: Append `docs/validate-correct.md` with complete analysis for backend/models/\*
  - _Requirements: 2.1, 3.1-3.5, 4.1-4.20, 5.1-5.10, 6.1-6.10, 7.1-7.11, 8.1-8.11, 9.1-9.11, 10.1-10.11, 11.1, 12.4, 12.5, 13.1-13.11_

- [ ] 8. Validate and Correct backend/models/plugins/\*

  - **Pre-Analysis**: Read `.kiro/specs/backend-validation-correction/requirements.md`, `.kiro/specs/backend-validation-correction/design.md`, `.kiro/specs/saas-task-manager-mvp/requirements.md`, `.kiro/specs/saas-task-manager-mvp/design.md`, `docs/build-prompt.md`, `docs/softDelete-doc.md`, `docs/TIMEZONE-MANAGEMENT.md` completely, especially `docs/softDelete-doc.md`
  - **SEARCH**: Discover all files in `backend/models/plugins/*` (softDelete.js)
  - **ANALYZE**: For EACH file, for EACH line:
    - Extract plugin function signature and schema modifications
    - Extract soft delete fields: isDeleted (Boolean, default: false, index: true), deletedAt (Date), deletedBy (ObjectId ref User)
    - Extract query middleware: find, findOne, findOneAndUpdate, countDocuments, aggregate
    - Extract withDeleted() method for bypassing soft delete filter
    - Extract softDelete() instance method with cascade logic
    - Extract restore() instance method
    - Extract TTL index configuration (deletedAt with expireAfterSeconds)
    - For EACH plugin feature, search ALL occurrences across ALL backend files
    - Verify consistency in: soft delete usage, withDeleted calls, cascade operations
  - **COMPARE**: Match against specifications in `docs/softDelete-doc.md`:
    - Verify plugin adds fields: isDeleted, deletedAt, deletedBy
    - Verify query middleware automatically filters isDeleted: false
    - Verify withDeleted() method bypasses filter
    - Verify softDelete(userId, session) instance method sets isDeleted: true, deletedAt: new Date(), deletedBy: userId
    - Verify restore(session) instance method sets isDeleted: false, deletedAt: null, deletedBy: null
    - Verify cascade soft delete for Organization → Departments → Users → Tasks
    - Verify TTL index: deletedAt with expireAfterSeconds: 30 days (2592000 seconds)
    - Verify session parameter support for transactions
    - Verify ES module syntax
  - **IDENTIFY**: Document issues:
    - Missing soft delete fields
    - Query middleware not filtering isDeleted
    - Missing withDeleted() method
    - Incorrect softDelete() implementation
    - Missing cascade logic
    - Missing TTL index
    - Missing session parameter support
    - Cross-validation: models not using plugin correctly
  - **IMPLEMENT**: Apply corrections:
    - Add all required soft delete fields
    - Implement query middleware with isDeleted filter
    - Add withDeleted() method
    - Fix softDelete() method with cascade logic
    - Add restore() method
    - Add TTL index configuration
    - Add session parameter support
    - Apply corrections consistently across ALL models using plugin
  - **VERIFY**: Without running tests:
    - Re-read all corrected files completely
    - Confirm all plugin features present
    - Confirm cascade logic correct
    - Confirm TTL index configured
    - Perform cross-validation: all models apply plugin correctly
    - Document verification results
  - **REPORT**: Append `docs/validate-correct.md` with complete analysis for backend/models/plugins/\*
  - _Requirements: 2.1, 3.1-3.5, 4.1-4.20, 5.1-5.10, 6.1-6.10, 7.1-7.11, 8.1-8.11, 9.1-9.11, 10.1-10.11, 11.1, 12.5, 13.1-13.11_

- [ ] 9. Validate and Correct backend/routes/\*

  - **Pre-Analysis**: Read `.kiro/specs/backend-validation-correction/requirements.md`, `.kiro/specs/backend-validation-correction/design.md`, `.kiro/specs/saas-task-manager-mvp/requirements.md`, `.kiro/specs/saas-task-manager-mvp/design.md`, `docs/build-prompt.md`, `docs/softDelete-doc.md`, `docs/TIMEZONE-MANAGEMENT.md` completely
  - **SEARCH**: Discover all files in `backend/routes/*` (authRoutes.js, userRoutes.js, organizationRoutes.js, departmentRoutes.js, taskRoutes.js, taskActivityRoutes.js, taskCommentRoutes.js, materialRoutes.js, vendorRoutes.js, attachmentRoutes.js, notificationRoutes.js, index.js)
  - **ANALYZE**: For EACH file, for EACH line:
    - Extract route definitions, HTTP methods, paths, middleware chains
    - Extract middleware order:  authMiddleware → validators → authorization → controller
    - Identify route parameters, query parameters, request body expectations
    - For EACH route, search ALL occurrences across ALL backend files (controllers, validators, authorization matrix)
    - Verify consistency in: route paths, middleware chains, controller mappings
  - **COMPARE**: Match against specifications:
    - Verify middleware chain order: authMiddleware → validators → authorization → controller
    - Verify route paths match RESTful conventions and design.md API endpoints
    - Verify HTTP methods correct (GET, POST, PUT, PATCH, DELETE)
    - Verify validators applied to ALL routes requiring input validation
    - Verify authMiddleware applied to ALL protected routes
    - Verify authorization middleware with correct resource/operation parameters
    - Verify controller functions exist and match route handlers
    - Verify index.js aggregates all routes with correct prefixes (/api/auth, /api/users, etc.)
    - Verify ES module syntax (import/export)
  - **IDENTIFY**: Document issues:
    - Incorrect middleware chain order
    - Missing validators on routes
    - Missing authMiddleware on protected routes
    - Missing authorization middleware
    - Incorrect authorization parameters
    - Route paths not matching specifications
    - Missing routes per design.md
    - Controller function mismatches
    - Missing route aggregation in index.js
    - Cross-validation: routes not matching controllers/validators
  - **IMPLEMENT**: Apply corrections:
    - Fix middleware chain order
    - Add missing validators
    - Add authMiddleware to protected routes
    - Add authorization middleware with correct parameters
    - Fix route paths per specifications
    - Add missing routes
    - Fix controller function mappings
    - Update index.js route aggregation
    - Apply corrections consistently across ALL routes
  - **VERIFY**: Without running tests:
    - Re-read all corrected files completely
    - Confirm middleware chain order correct on ALL routes
    - Confirm all routes have proper validation
    - Confirm all protected routes have auth/authz
    - Perform cross-validation: routes match controllers and validators
    - Document verification results
  - **REPORT**: Append `docs/validate-correct.md` with complete analysis for backend/routes/\*
  - _Requirements: 2.1, 3.1-3.5, 4.1-4.20, 5.1-5.10, 6.1-6.10, 7.1-7.11, 8.1-8.11, 9.1-9.11, 10.1-10.11, 11.1, 12.6, 13.1-13.11_

- [ ] 10. Validate and Correct backend/services/\*

  - **Pre-Analysis**: Read `.kiro/specs/backend-validation-correction/requirements.md`, `.kiro/specs/backend-validation-correction/design.md`, `.kiro/specs/saas-task-manager-mvp/requirements.md`, `.kiro/specs/saas-task-manager-mvp/design.md`, `docs/build-prompt.md`, `docs/softDelete-doc.md`, `docs/TIMEZONE-MANAGEMENT.md` completely
  - **SEARCH**: Discover all files in `backend/services/*` (emailService.js, notificationService.js)
  - **ANALYZE**: For EACH file, for EACH line:
    - Extract email service configuration, Nodemailer transporter, email templates
    - Extract notification service functions, notification creation logic
    - Identify email sending patterns, template rendering, error handling
    - For EACH service function, search ALL occurrences across ALL backend files
    - Verify consistency in: service usage, error handling, parameter passing
  - **COMPARE**: Match against specifications:
    - Verify emailService uses Nodemailer v7.0.9 with Gmail SMTP
    - Verify transporter configuration: host: smtp.gmail.com, port: 587, secure: false, auth: {user: EMAIL_USER, pass: EMAIL_PASS}
    - Verify email templates in backend/templates/\* are used correctly
    - Verify email functions: sendVerificationEmail, sendPasswordResetEmail, sendTaskAssignmentEmail, etc.
    - Verify notificationService creates Notification documents
    - Verify notification types match constants from utils/constants.js
    - Verify Socket.IO emission after notification creation
    - Verify CustomError usage for service failures
    - Verify ES module syntax
  - **IDENTIFY**: Document issues:
    - Incorrect Nodemailer configuration
    - Missing email functions
    - Hardcoded email templates instead of using template files
    - Hardcoded notification types instead of constants
    - Missing Socket.IO emissions
    - Incorrect error handling
    - Cross-validation: services called incorrectly from controllers
  - **IMPLEMENT**: Apply corrections:
    - Fix Nodemailer configuration
    - Add missing email functions
    - Use template files for email content
    - Replace hardcoded types with constants
    - Add Socket.IO emissions
    - Fix error handling with CustomError
    - Apply corrections consistently across ALL service usages
  - **VERIFY**: Without running tests:
    - Re-read all corrected files completely
    - Confirm Nodemailer configuration correct
    - Confirm all email functions present
    - Confirm notification types use constants
    - Perform cross-validation: services used correctly in controllers
    - Document verification results
  - **REPORT**: Append `docs/validate-correct.md` with complete analysis for backend/services/\*
  - _Requirements: 2.1, 3.1-3.5, 4.1-4.20, 5.1-5.10, 6.1-6.10, 7.1-7.11, 8.1-8.11, 9.1-9.11, 10.1-10.11, 11.1, 12.7, 13.1-13.11_

- [ ] 11. Validate and Correct backend/templates/\*

  - **Pre-Analysis**: Read `.kiro/specs/backend-validation-correction/requirements.md`, `.kiro/specs/backend-validation-correction/design.md`, `.kiro/specs/saas-task-manager-mvp/requirements.md`, `.kiro/specs/saas-task-manager-mvp/design.md`, `docs/build-prompt.md`, `docs/softDelete-doc.md`, `docs/TIMEZONE-MANAGEMENT.md` completely
  - **SEARCH**: Discover all files in `backend/templates/*` (email templates: verification.html, passwordReset.html, taskAssignment.html, etc.)
  - **ANALYZE**: For EACH file, for EACH line:
    - Extract HTML structure, template variables, styling
    - Identify placeholders for dynamic content ({{variable}})
    - Document template usage patterns
    - For EACH template, search ALL occurrences across ALL backend files (emailService usage)
    - Verify consistency in: template variables, naming conventions
  - **COMPARE**: Match against specifications:
    - Verify template files exist for all email types in design.md
    - Verify HTML structure is valid and responsive
    - Verify template variables match data passed from emailService
    - Verify branding and styling consistent across templates
    - Verify links use environment variables (CLIENT_URL, API_URL)
    - Verify no hardcoded URLs or values
    - Verify accessibility standards (alt text, semantic HTML)
  - **IDENTIFY**: Document issues:
    - Missing email templates
    - Invalid HTML structure
    - Template variables not matching service calls
    - Hardcoded URLs instead of environment variables
    - Inconsistent styling across templates
    - Missing accessibility features
    - Cross-validation: templates not matching emailService calls
  - **IMPLEMENT**: Apply corrections:
    - Add missing email templates
    - Fix HTML structure
    - Align template variables with service calls
    - Replace hardcoded URLs with environment variables
    - Standardize styling across templates
    - Add accessibility features
    - Apply corrections consistently across ALL templates
  - **VERIFY**: Without running tests:
    - Re-read all corrected files completely
    - Confirm all templates present
    - Confirm HTML valid
    - Confirm variables match service calls
    - Perform cross-validation: templates match emailService usage
    - Document verification results
  - **REPORT**: Append `docs/validate-correct.md` with complete analysis for backend/templates/\*
  - _Requirements: 2.1, 3.1-3.5, 4.1-4.20, 5.1-5.10, 6.1-6.10, 7.1-7.11, 8.1-8.11, 9.1-9.11, 10.1-10.11, 11.1, 12.8, 13.1-13.11_

- [ ] 12. Validate and Correct backend/utils/\*

  - **Pre-Analysis**: Read `.kiro/specs/backend-validation-correction/requirements.md`, `.kiro/specs/backend-validation-correction/design.md`, `.kiro/specs/saas-task-manager-mvp/requirements.md`, `.kiro/specs/saas-task-manager-mvp/design.md`, `docs/build-prompt.md`, `docs/softDelete-doc.md`, `docs/TIMEZONE-MANAGEMENT.md` completely, especially `docs/TIMEZONE-MANAGEMENT.md`
  - **SEARCH**: Discover all files in `backend/utils/*` (constants.js, logger.js, helpers.js, generateTokens.js, authorizationMatrix.js, validateEnv.js, socket.js, socketEmitter.js, socketInstance.js, userStatus.js, responseTransform.js, materialTransform.js)
  - **ANALYZE**: For EACH file, for EACH line:
    - Extract ALL constants definitions (SINGLE SOURCE OF TRUTH)
    - Extract logger configuration, log levels, transports
    - Extract helper functions, utility logic
    - Extract JWT generation logic, token expiration
    - Extract authorization matrix permission checking
    - Extract environment variable validation
    - Extract Socket.IO setup, event emitters, singleton instance
    - Extract response transformation logic
    - For EACH constant/function, search ALL occurrences across ALL backend files
    - Verify consistency in: constant usage, function calls, parameter passing
  - **COMPARE**: Match against specifications:
    - Verify constants.js contains ALL constants used throughout backend (roles, statuses, task types, priorities, notification types, etc.)
    - Verify NO hardcoded values exist in other files that should be in constants.js
    - Verify logger uses winston v3.18.3 with file and console transports
    - Verify log levels: error, warn, info, debug
    - Verify generateTokens creates access and refresh tokens with correct expiration
    - Verify authorizationMatrix.js checks permissions against config/authorizationMatrix.json
    - Verify validateEnv checks ALL required environment variables at startup
    - Verify socket.js initializes Socket.IO with CORS configuration
    - Verify socketEmitter.js provides event emission functions
    - Verify socketInstance.js implements singleton pattern
    - Verify responseTransform formats responses consistently
    - Verify materialTransform handles material data conversion
    - Verify timezone handling: dayjs with UTC plugin, convertUTCToLocal, convertLocalToUTC
    - Verify ES module syntax
  - **IDENTIFY**: Document issues:
    - Missing constants in constants.js
    - Hardcoded values in other files
    - Incorrect logger configuration
    - Missing log statements in critical paths
    - Incorrect JWT expiration times
    - Missing permission checks in authorizationMatrix
    - Missing environment variables in validateEnv
    - Incorrect Socket.IO configuration
    - Missing event emitters
    - Incorrect response transformation
    - Missing timezone conversion functions
    - Cross-validation: constants not used consistently across files
  - **IMPLEMENT**: Apply corrections:
    - Add ALL missing constants to constants.js
    - Replace ALL hardcoded values with constants imports
    - Fix logger configuration
    - Add missing log statements
    - Fix JWT expiration times
    - Add missing permission checks
    - Add missing environment variables
    - Fix Socket.IO configuration
    - Add missing event emitters
    - Fix response transformation
    - Add timezone conversion functions per TIMEZONE-MANAGEMENT.md
    - Apply corrections consistently across ALL files using utils
  - **VERIFY**: Without running tests:
    - Re-read all corrected files completely
    - Confirm ALL constants in constants.js
    - Confirm NO hardcoded values in entire backend
    - Confirm logger configured correctly
    - Confirm JWT generation correct
    - Confirm Socket.IO setup correct
    - Perform cross-validation: utils used consistently across all files
    - Document verification results
  - **REPORT**: Append `docs/validate-correct.md` with complete analysis for backend/utils/\*
  - _Requirements: 2.1, 3.1-3.5, 4.1-4.20, 5.1-5.10, 6.1-6.10, 7.1-7.11, 8.1-8.11, 9.1-9.11, 10.1-10.11, 11.1, 12.9, 12.10, 13.1-13.11_

- [ ] 13. Validate and Correct backend/.env, app.js, server.js

  - **Pre-Analysis**: Read `.kiro/specs/backend-validation-correction/requirements.md`, `.kiro/specs/backend-validation-correction/design.md`, `.kiro/specs/saas-task-manager-mvp/requirements.md`, `.kiro/specs/saas-task-manager-mvp/design.md`, `docs/build-prompt.md`, `docs/softDelete-doc.md`, `docs/TIMEZONE-MANAGEMENT.md` completely
  - **SEARCH**: Discover files: backend/.env, backend/app.js, backend/server.js
  - **ANALYZE**: For EACH file, for EACH line:
    - Extract ALL environment variables from .env
    - Extract Express app configuration, middleware setup, route mounting from app.js
    - Extract server startup, port binding, graceful shutdown from server.js
    - For EACH configuration element, search ALL occurrences across ALL backend files
    - Verify consistency in: environment variable usage, middleware order, route prefixes
  - **COMPARE**: Match against specifications:
    - Verify .env contains ALL required variables per validateEnv.js and design.md:
      - NODE_ENV, PORT, MONGODB_URI, MONGODB_URI_TEST
      - JWT_ACCESS_SECRET, JWT_REFRESH_SECRET, ACCESS_TOKEN_EXPIRY, REFRESH_TOKEN_EXPIRY
      - CLIENT_URL, ALLOWED_ORIGINS
      - EMAIL_USER, EMAIL_PASS
      - CLOUDINARY_CLOUD_NAME, CLOUDINARY_API_KEY, CLOUDINARY_API_SECRET
    - Verify app.js middleware order:
      1. helmet() for security headers
      2. express.json() and express.urlencoded()
      3. cookieParser()
      4. corsOptions from config/corsOptions.js
      5. express-mongo-sanitize
      6. rateLimiter (production only)
      7. Route mounting with /api prefix
      8. ErrorController as last middleware
    - Verify app.js uses ES module syntax
    - Verify server.js:
      - Imports app from app.js
      - Calls validateEnv() before starting
      - Connects to MongoDB via db.js
      - Initializes Socket.IO via socket.js
      - Binds to PORT from environment
      - Implements graceful shutdown (SIGTERM, SIGINT)
      - Uses ES module syntax
  - **IDENTIFY**: Document issues:
    - Missing environment variables
    - Incorrect middleware order in app.js
    - Missing security middleware
    - Incorrect route prefixes
    - Missing error handler
    - Missing environment validation in server.js
    - Missing graceful shutdown
    - CommonJS syntax instead of ES modules
    - Cross-validation: environment variables not matching usage across files
  - **IMPLEMENT**: Apply corrections:
    - Add ALL missing environment variables to .env
    - Fix middleware order in app.js
    - Add missing security middleware
    - Fix route prefixes
    - Ensure ErrorController is last middleware
    - Add validateEnv() call in server.js
    - Add graceful shutdown handlers
    - Convert to ES module syntax
    - Apply corrections consistently across ALL files using these configurations
  - **VERIFY**: Without running tests:
    - Re-read all corrected files completely
    - Confirm ALL environment variables present
    - Confirm middleware order correct
    - Confirm server startup sequence correct
    - Perform cross-validation: configurations used correctly across all files
    - Document verification results
  - **REPORT**: Append `docs/validate-correct.md` with complete analysis for backend/.env, app.js, server.js
  - _Requirements: 2.1, 3.1-3.5, 4.1-4.20, 5.1-5.10, 6.1-6.10, 7.1-7.11, 8.1-8.11, 9.1-9.11, 10.1-10.11, 11.1, 12.9, 12.10, 13.1-13.11_

- [ ] 14. Git Post-Operations and Final Validation Report
  - **VERIFY COMPLETENESS**: Before finalizing, perform comprehensive cross-validation:
    - Confirm ALL 76 backend files analyzed and corrected
    - Confirm ALL critical patterns validated: CustomError static methods, transactions, soft delete, timezone, constants
    - Confirm NO hardcoded values remain (all constants imported)
    - Confirm ALL specifications from `.kiro/specs/backend-validation-correction/requirements.md`, `.kiro/specs/backend-validation-correction/design.md`, `.kiro/specs/saas-task-manager-mvp/requirements.md`, `.kiro/specs/saas-task-manager-mvp/design.md`, `docs/build-prompt.md`, `docs/softDelete-doc.md`, `docs/TIMEZONE-MANAGEMENT.md` completely implemented
    - Confirm consistency across ALL files (naming, patterns, imports, exports)
    - Confirm ES module syntax throughout
  - **FINALIZE REPORT**: Complete `docs/validate-correct.md`:
    - Add Executive Summary section with overall statistics
    - Add Total Issues Found and Total Issues Corrected counts
    - Add Critical Patterns Validation section with pass/fail for each pattern
    - Add Completeness Validation section confirming all requirements met
    - Add Cross-Validation Summary showing consistency across files
    - Add Recommendations section for future maintenance
    - Ensure report is comprehensive and actionable
  - **GIT OPERATIONS**:
    - Execute `git status` to verify all changes staged
    - Review all modified files list
    - IF uncommitted changes THEN:
      - Execute `git add .` to stage all changes
      - Execute `git commit -m "validate: comprehensive backend validation and correction - all 76 files aligned with specifications"`
      - Use conventional commit format with "validate:" prefix
    - Execute `git push origin validate/backend-comprehensive` to push to remote
    - IF push fails THEN:
      - Execute `git pull --rebase origin validate/backend-comprehensive`
      - Resolve any conflicts
      - Execute `git push origin validate/backend-comprehensive`
    - Execute `git status` and `git branch -vv` to confirm sync
    - Verify: "Your branch is up to date with 'origin/validate/backend-comprehensive'"
  - **FINAL VERIFICATION**:
    - Confirm all changes committed and pushed
    - Confirm validation report complete and accurate
    - Confirm no uncommitted changes remain
    - Confirm branch synced with remote
  - **COMPLETION**: Mark all tasks complete and notify user of successful validation and correction
  - _Requirements: 1.6, 1.7, 1.8, 9.1-9.11, 10.1-10.11, 11.1, 13.1-13.11, 23.8, 23.9, 23.10, 23.11, 23.12, 23.13_

## Execution Notes

**CRITICAL REMINDERS**:

1. **Line-by-Line Cross-Validation**: For EVERY line of code in each file, identify the item/logic and search ALL occurrences across ALL backend files to ensure consistency
2. **Search Scope**: ALWAYS search across ALL directories: config, controllers, errorHandler, middlewares, validators, models, plugins, routes, services, templates, utils, .env, app.js, server.js
3. **No Testing**: Verification is performed WITHOUT writing or running tests - use code analysis and cross-validation only
4. **Complete Coverage**: All 76 backend files MUST be analyzed - no file can be skipped
5. **Specification Alignment**: Every correction MUST align with `.kiro/specs/saas-task-manager-mvp/*` and `docs/*`
6. **Constants Usage**: ALL hardcoded values MUST be replaced with imports from utils/constants.js
7. **Critical Patterns**: CustomError static methods, transactions, soft delete, timezone handling, ES modules MUST be validated in every applicable file
8. **Git Workflow**: Pre-operations before starting, post-operations after completing all tasks
9. **Validation Report**: `docs/validate-correct.md` MUST be updated after each task with detailed findings
10. **Consistency**: Cross-validation ensures naming, patterns, and usage are consistent across ALL files

**Task Dependencies**:

- Task 1 MUST complete before any other task (Git pre-operations)
- Tasks 2-13 can be executed sequentially (each task depends on previous task's corrections)
- Task 14 MUST be last (Git post-operations and final report)

**Estimated Duration**: 4-6 hours for complete validation and correction of all 76 files

---

**END OF IMPLEMENTATION PLAN**
